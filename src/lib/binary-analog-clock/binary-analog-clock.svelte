<script lang="ts">
	import { roundToNearestEven } from '$lib/utils';
	import PomodoroFlipItem from '$lib/pomodoro/PomodoroFlipItem.svelte';

	export let hours: number;
	export let minutes: number;
	export let seconds: number;
	export let clockSize: number;
	export let showSeconds: boolean;
	export let pomodoro: App.PomodoroSettings;

	$: gap = roundToNearestEven(clockSize);
	$: hourDegrees = ((hours % 12) * 30 + minutes * 0.5) % 360;
	$: minuteDegrees = (minutes * 6 + seconds * 0.1) % 360;
	$: secondDegrees = seconds * 6;
</script>

<div
	class="clock-container"
	style:gap="{gap}px"
	style:padding="{gap}px"
	style:--hour-rotate={`${hourDegrees}deg`}
	style:--minute-rotate={`${minuteDegrees}deg`}
	style:--second-rotate={`${secondDegrees}deg`}
	class:show-seconds={showSeconds}
	class:show-pomodoro={pomodoro.showPomodoro}
>
	{#if pomodoro.showPomodoro}
		<div class="pomodoro">
			<PomodoroFlipItem interval={pomodoro.interval} focusTime={pomodoro.focusTime} />
		</div>
	{/if}

	<div class="clock">
		<div class="clock-hand hour-hand" />
		<div class="clock-hand minute-hand" />
		{#if showSeconds}
			<div class="second-dial">
				<div class="clock-hand second-hand" />
			</div>
		{/if}
		<svg
			width="100%"
			height="100%"
			viewBox="0 0 100 100"
			fill="none"
			xmlns="http://www.w3.org/2000/svg"
		>
			<path
				fill-rule="evenodd"
				clip-rule="evenodd"
				d="M88.21 46.43L82.75 46.43L82.75 45.12L82 45.12V48.37H82.75V47.28L89 47.28V46.33L88.5 45.02H87.69L88.21 46.43ZM88.21 51.8304L82.75 51.8304L82.75 50.5204H82V53.7704H82.75V52.6804L89 52.6804V51.7304L88.5 50.4204H87.69L88.21 51.8304Z"
				fill="white"
			/>
			<path
				fill-rule="evenodd"
				clip-rule="evenodd"
				d="M44.43 82.79V88.25H43.12V89H46.37V88.25H45.28V82H44.33L43.02 82.5V83.31L44.43 82.79ZM49.8304 88.25V82.79L48.4204 83.31V82.5L49.7304 82H50.6804V88.25H51.7704V89H48.5204V88.25H49.8304ZM57.2808 87.3C57.2808 87.8533 57.1274 88.2767 56.8208 88.57C56.5208 88.8567 56.1141 89 55.6008 89H55.4008C54.8874 89 54.4774 88.8567 54.1708 88.57C53.8708 88.2767 53.7208 87.8533 53.7208 87.3V83.7C53.7208 83.14 53.8708 82.7167 54.1708 82.43C54.4708 82.1433 54.8808 82 55.4008 82H55.6008C56.1208 82 56.5308 82.1433 56.8308 82.43C57.1308 82.7167 57.2808 83.14 57.2808 83.7V87.3ZM56.4308 83.51C56.4308 83.3033 56.3508 83.1267 56.1908 82.98C56.0374 82.8267 55.8408 82.75 55.6008 82.75H55.4008C55.1608 82.75 54.9608 82.8267 54.8008 82.98C54.6474 83.1267 54.5708 83.3033 54.5708 83.51V86.22L56.4308 83.51ZM54.5708 87.49C54.5708 87.6967 54.6474 87.8767 54.8008 88.03C54.9608 88.1767 55.1608 88.25 55.4008 88.25H55.6008C55.8408 88.25 56.0374 88.1767 56.1908 88.03C56.3508 87.8767 56.4308 87.6967 56.4308 87.49V84.79L54.5708 87.49Z"
				fill="white"
			/>
			<path
				fill-rule="evenodd"
				clip-rule="evenodd"
				d="M11.79 42.3688L17.25 42.3688V43.6788H18V40.4288H17.25V41.5188L11 41.5188V42.4688L11.5 43.7788H12.31L11.79 42.3688ZM17.57 46.1793C17.2767 45.8726 16.8533 45.7193 16.3 45.7193H12.7C12.14 45.7193 11.7167 45.8693 11.43 46.1693C11.1433 46.4693 11 46.8793 11 47.3993V47.5993C11 48.1193 11.1433 48.5293 11.43 48.8293C11.7167 49.1293 12.14 49.2793 12.7 49.2793H16.3C16.8533 49.2793 17.2767 49.1293 17.57 48.8293C17.8567 48.5226 18 48.1126 18 47.5993V47.3993C18 46.8859 17.8567 46.4793 17.57 46.1793ZM11.98 46.8093C12.1267 46.6493 12.3033 46.5693 12.51 46.5693L15.22 48.4293H12.51C12.3033 48.4293 12.1267 48.3526 11.98 48.1993C11.8267 48.0393 11.75 47.8393 11.75 47.5993V47.3993C11.75 47.1593 11.8267 46.9626 11.98 46.8093ZM17.03 48.1993C16.8767 48.3526 16.6967 48.4293 16.49 48.4293L13.79 46.5693L16.49 46.5693C16.6967 46.5693 16.8767 46.6493 17.03 46.8093C17.1767 46.9626 17.25 47.1593 17.25 47.3993V47.5993C17.25 47.8393 17.1767 48.0393 17.03 48.1993ZM16.3 51.1197C16.8533 51.1197 17.2767 51.273 17.57 51.5797C17.8567 51.8797 18 52.2863 18 52.7997V52.9997C18 53.513 17.8567 53.923 17.57 54.2297C17.2767 54.5297 16.8533 54.6797 16.3 54.6797H12.7C12.14 54.6797 11.7167 54.5297 11.43 54.2297C11.1433 53.9297 11 53.5197 11 52.9997V52.7997C11 52.2797 11.1433 51.8697 11.43 51.5697C11.7167 51.2697 12.14 51.1197 12.7 51.1197H16.3ZM12.51 51.9697C12.3033 51.9697 12.1267 52.0497 11.98 52.2097C11.8267 52.363 11.75 52.5597 11.75 52.7997V52.9997C11.75 53.2397 11.8267 53.4397 11.98 53.5997C12.1267 53.753 12.3033 53.8297 12.51 53.8297H15.22L12.51 51.9697ZM16.49 53.8297C16.6967 53.8297 16.8767 53.753 17.03 53.5997C17.1767 53.4397 17.25 53.2397 17.25 52.9997V52.7997C17.25 52.5597 17.1767 52.363 17.03 52.2097C16.8767 52.0497 16.6967 51.9697 16.49 51.9697H13.79L16.49 53.8297ZM11.79 58.57H17.25V59.88H18V56.63H17.25V57.72H11V58.67L11.5 59.98H12.31L11.79 58.57Z"
				fill="white"
			/>
			<path
				fill-rule="evenodd"
				clip-rule="evenodd"
				d="M41.43 11.79V17.25H40.12V18H43.37V17.25H42.28V11H41.33L40.02 11.5V12.31L41.43 11.79ZM46.8304 17.25V11.79L45.4204 12.31V11.5L46.7304 11H47.6804V17.25H48.7704V18H45.5204V17.25H46.8304ZM53.8208 17.57C54.1274 17.2767 54.2808 16.8533 54.2808 16.3V12.7C54.2808 12.14 54.1308 11.7167 53.8308 11.43C53.5308 11.1433 53.1208 11 52.6008 11H52.4008C51.8808 11 51.4708 11.1433 51.1708 11.43C50.8708 11.7167 50.7208 12.14 50.7208 12.7V16.3C50.7208 16.8533 50.8708 17.2767 51.1708 17.57C51.4774 17.8567 51.8874 18 52.4008 18H52.6008C53.1141 18 53.5208 17.8567 53.8208 17.57ZM53.1908 11.98C53.3508 12.1267 53.4308 12.3033 53.4308 12.51L51.5708 15.22V12.51C51.5708 12.3033 51.6474 12.1267 51.8008 11.98C51.9608 11.8267 52.1608 11.75 52.4008 11.75H52.6008C52.8408 11.75 53.0374 11.8267 53.1908 11.98ZM51.8008 17.03C51.6474 16.8767 51.5708 16.6967 51.5708 16.49L53.4308 13.79V16.49C53.4308 16.6967 53.3508 16.8767 53.1908 17.03C53.0374 17.1767 52.8408 17.25 52.6008 17.25H52.4008C52.1608 17.25 51.9608 17.1767 51.8008 17.03ZM59.2212 17.57C59.5278 17.2767 59.6812 16.8533 59.6812 16.3V12.7C59.6812 12.14 59.5312 11.7167 59.2312 11.43C58.9312 11.1433 58.5212 11 58.0012 11H57.8012C57.2812 11 56.8712 11.1433 56.5712 11.43C56.2712 11.7167 56.1212 12.14 56.1212 12.7V16.3C56.1212 16.8533 56.2712 17.2767 56.5712 17.57C56.8778 17.8567 57.2878 18 57.8012 18H58.0012C58.5145 18 58.9212 17.8567 59.2212 17.57ZM58.5912 11.98C58.7512 12.1267 58.8312 12.3033 58.8312 12.51L56.9712 15.22V12.51C56.9712 12.3033 57.0478 12.1267 57.2012 11.98C57.3612 11.8267 57.5612 11.75 57.8012 11.75H58.0012C58.2412 11.75 58.4378 11.8267 58.5912 11.98ZM57.2012 17.03C57.0478 16.8767 56.9712 16.6967 56.9712 16.49L58.8312 13.79V16.49C58.8312 16.6967 58.7512 16.8767 58.5912 17.03C58.4378 17.1767 58.2412 17.25 58.0012 17.25H57.8012C57.5612 17.25 57.3612 17.1767 57.2012 17.03Z"
				fill="white"
			/>
			<path
				fill-rule="evenodd"
				clip-rule="evenodd"
				d="M34.1363 97H35.1878L36.5761 92.7273H35.5246L34.1363 97ZM39.4075 97H40.4299L41.3381 92.7273H40.3157L39.4075 97ZM44.4374 97H45.4429L45.8919 92.7273H44.8864L44.4374 97ZM49.3464 97H50.3464V92.7273H49.3464V97ZM54.2444 97H55.2499L54.8008 92.7273H53.7953L54.2444 97ZM59.2405 97H60.2629L59.3547 92.7273H58.3323L59.2405 97ZM64.4535 97H65.505L64.1167 92.7273H63.0653L64.4535 97ZM70.0232 97H71.1179L69.2155 92.7273H68.1209L70.0232 97ZM73.6602 92.7273L76.127 97H77.2817L74.8149 92.7273L68.6214 82H67.4667L73.6602 92.7273ZM84 97C84.0804 97 84.1605 96.9993 84.2405 96.9978L81.0868 92.6571C80.6964 92.6976 80.3008 92.7209 79.9009 92.7262L83.0061 97H84ZM89.7869 95.6442C90.0943 95.4911 90.3947 95.3262 90.6877 95.1502L86.6884 90.7085C86.4014 90.8908 86.1068 91.0621 85.8051 91.222L89.7869 95.6442ZM95.15 90.6879C95.3261 90.3949 95.491 90.0945 95.6441 89.7871L91.2219 85.8053C91.062 86.107 90.8907 86.4016 90.7084 86.6886L95.15 90.6879ZM97 84V83.0061L92.7262 79.901C92.7209 80.3009 92.6976 80.6965 92.6571 81.0869L96.9978 84.2406C96.9993 84.1606 97 84.0804 97 84ZM92.7273 74.8151L97 77.2819V76.1272L92.7273 73.6604L82 67.467V68.6217L92.7273 74.8151ZM97 71.118V70.0234L92.7273 68.1211V69.2157L97 71.118ZM97 65.5051V64.4537L92.7273 63.0654V64.1168L97 65.5051ZM97 60.263V59.2406L92.7273 58.3325V59.3548L97 60.263ZM97 55.2499V54.2444L92.7273 53.7953V54.8009L97 55.2499ZM97 50.3465V49.3465H92.7273V50.3465H97ZM97 45.443V44.4375L92.7273 44.8865V45.892L97 45.443ZM97 40.4299V39.4076L92.7273 40.3158V41.3381L97 40.4299ZM97 35.1877V34.1362L92.7273 35.5245V36.576L97 35.1877ZM97 29.575V28.4803L92.7273 30.3827V31.4773L97 29.575ZM92.7273 25.8777L97 23.4108V22.2561L92.7273 24.723L81.9997 30.9165L82 31V32.071L92.7273 25.8777ZM97 16C97 15.7418 96.9925 15.4854 96.9776 15.2309L92.5955 18.4147C92.6498 18.7943 92.6878 19.1792 92.7085 19.5686L97 16.4507V16ZM95.4122 9.76901C95.2488 9.47036 95.074 9.17882 94.8884 8.89498L90.4376 12.9025C90.6293 13.1805 90.8104 13.4663 90.9804 13.7594L95.4122 9.76901ZM91.0869 5.09974C90.8026 4.91456 90.5107 4.74021 90.2117 4.57725L86.2216 9.00865C86.5151 9.17821 86.8013 9.3589 87.0797 9.55016L91.0869 5.09974ZM84 3H83.5095L80.393 7.28951C80.7832 7.30919 81.1688 7.34608 81.5492 7.39942L84.7309 3.0202C84.489 3.00679 84.2453 3 84 3ZM75.215 7.27276L77.6819 3H76.5272L74.0603 7.27276L67.8668 18H69L69.0215 18L75.215 7.27276ZM71.4264 3H70.3317L68.4294 7.27276H69.524L71.4264 3ZM65.7302 3H64.6788L63.2905 7.27276H64.3419L65.7302 3ZM60.4101 3H59.3878L58.4796 7.27276H59.5019L60.4101 3ZM55.3226 3H54.3172L53.8681 7.27276H54.8736L55.3226 3ZM50.3464 3H49.3464V7.27276H50.3464V3ZM45.3701 3H44.3646L44.8137 7.27276H45.8192L45.3701 3ZM40.2826 3H39.2602L40.1684 7.27276H41.1908L40.2826 3ZM34.9626 3H33.9111L35.2994 7.27276H36.3509L34.9626 3ZM29.2664 3H28.1717L30.0741 7.27276H31.1688L29.2664 3ZM23.0108 3H23.0108H21.8561H21.8561L30.5213 18.0086C30.6802 18.0029 30.8397 18 31 18H31.671L25.4776 7.27276H25.4777L23.0108 3ZM15.9472 3.0001C15.5449 3.0017 15.1468 3.02158 14.7539 3.05895L17.9639 7.47717C18.3341 7.41082 18.7097 7.36014 19.09 7.32584L15.9472 3.0001ZM9.3569 4.82317C9.06639 4.99621 8.7832 5.18026 8.5079 5.37473L12.5232 9.83414C12.7927 9.63368 13.0703 9.44343 13.3554 9.26393L9.3569 4.82317ZM5.3746 8.50808C5.18013 8.78339 4.99609 9.06658 4.82305 9.3571L9.26381 13.3556C9.4433 13.0705 9.63355 12.7929 9.834 12.5233L5.3746 8.50808ZM3.05894 14.7539C3.02158 15.1469 3.0017 15.5449 3.0001 15.9473L7.32583 19.0901C7.36013 18.7098 7.41081 18.3341 7.47716 17.964L3.05894 14.7539ZM7.27276 24.3232L3 21.8563V23.011V23.011L7.27276 25.4779L18 31.6713V31C18 30.8398 18.0029 30.6804 18.0086 30.5216L7.27276 24.3232ZM3 28.1719V29.2666L7.27276 31.1689V30.0743L3 28.1719ZM3 33.9112V34.9627L7.27276 36.351V35.2995L3 33.9112ZM3 39.2603V40.2827L7.27276 41.1909V40.1685L3 39.2603ZM3 44.3646V45.3701L7.27276 45.8192V44.8137L3 44.3646ZM3 49.3465V50.3465H7.27276V49.3465H3ZM3 54.3173V55.3228L7.27276 54.8737V53.8682L3 54.3173ZM3 59.3879V60.4102L7.27276 59.502V58.4797L3 59.3879ZM3 64.6787V65.7301L7.27276 64.3418V63.2904L3 64.6787ZM3 70.3318V71.4265L7.27276 69.5241V68.4295L3 70.3318ZM7.27276 74.0602L3 76.5271V77.6818L7.27276 75.2149L18 69.0215L18 69V67.8668L7.27276 74.0602ZM3 84C3 84.2453 3.0068 84.4891 3.02021 84.731L7.39944 81.5493C7.34609 81.169 7.3092 80.7833 7.28952 80.3931L3 83.5097V84ZM4.57719 90.2116C4.74015 90.5106 4.9145 90.8025 5.09967 91.0868L9.55009 87.0796C9.35884 86.8012 9.17815 86.515 9.00859 86.2215L4.57719 90.2116ZM8.89509 94.8885C9.17892 95.0741 9.47046 95.2489 9.76911 95.4123L13.7595 90.9805C13.4664 90.8105 13.1806 90.6293 12.9026 90.4377L8.89509 94.8885ZM29.5749 97H28.4802L30.3826 92.7273H31.4772L29.5749 97ZM23.4109 97L25.8778 92.7273L32.0711 82H31L30.9166 81.9997L24.7231 92.7273L22.2562 97H23.4109ZM16.4506 97L19.5685 92.7085C19.1791 92.6878 18.7942 92.6498 18.4146 92.5955L15.2308 96.9776C15.4853 96.9925 15.7418 97 16 97H16.4506Z"
				fill="white"
			/>
		</svg>
	</div>
</div>

<style>
	.clock-container {
		display: grid;
		height: 100vh;
		grid-template-columns: 1fr;
		grid-template-rows: 1fr;

		.clock {
			grid-column-start: 1;
			grid-column-end: 2;
			background-color: oklch(var(--b3));
			border-radius: 16%;
			position: relative;

			&::after {
				content: '';
				position: absolute;
				top: 50%;
				left: 50%;
				transform: translate(-50%, -50%);
				width: 4%;
				height: 4%;
				min-width: 4px;
				min-height: 4px;
				background-color: white;
				border-radius: 50%;
			}
		}

		.clock-hand {
			position: absolute;
			left: 50%;
			top: 50%;
			transform-origin: 50% 100%;
			transform: translate(-50%, -100%);
			background-color: white;
		}

		.hour-hand {
			width: 4%;
			min-width: 4px;
			height: 25%;
			transform: translate(-50%, -100%) rotate(var(--hour-rotate));
		}

		.minute-hand {
			width: 2%;
			min-width: 2px;
			height: 30%;
			transform: translate(-50%, -100%) rotate(var(--minute-rotate));
		}

		.second-dial {
			position: absolute;
			left: 50%;
			bottom: 23%;
			transform: translateX(-50%);
			width: 20%;
			min-width: 2px;
			height: 20%;
			border-radius: 100%;
			box-shadow: inset 0 0 8px 2px rgba(0, 0, 0, 0.5);
		}

		.second-hand {
			width: 2%;
			min-width: 1px;
			height: 44%;
			transform: translate(-50%, -100%) rotate(var(--second-rotate));
		}

		&.show-pomodoro {
			grid-template-columns: repeat(2, 1fr);

			.pomodoro {
				grid-column-start: 1;
				grid-column-end: 2;
			}

			.clock {
				grid-column-start: 2;
				grid-column-end: 3;
			}
		}
	}
</style>
